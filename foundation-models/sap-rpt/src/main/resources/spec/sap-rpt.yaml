# Unofficial OpenAPI specification for SAP RPT API.
openapi: 3.0.0

info:
  title: SAP RPT API
  description: SAP RPT API for predictive insights using in-context learning on structured business data.
  version: 0.0.1-SNAPSHOT

paths:
  /deployments/{deployment-id}/completions:
    post:
      summary: Predict targets using SAP RPT model with structured data.
      operationId: Completions_Create
      parameters:
        - name: deployment-id
          in: path
          required: true
          schema:
            type: string
            example: davinci
            description: Deployment id of the model which was deployed.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TabCompletionPostRequest'
      responses:
        '200':
          description: Successful response with predictive insights.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TabCompletionPostResponse'
        '400':
          description: Bad Request - Invalid input.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Unprocessable Content - Invalid input.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal Server Error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'

components:
  schemas:
    TabCompletionPostRequest:
      type: object
      description: Request for tabular prediction. Must provide data as either rows or columns (mutually exclusive).
      properties:
        prediction_config:
          $ref: '#/components/schemas/PredictionConfig'
        index_column:
          type: string
          description: Optional column name used to identify rows. Not used as input feature, but returned in response.
          example: "ID"
        rows:
          type: array
          description: Table data organized by rows (mutually exclusive with columns).
          items:
            type: object
            additionalProperties: true
          example:
            - PRODUCT: "Couch"
              PRICE: 999.99
              ORDERDATE: "28-11-2025"
              ID: "35"
              COSTCENTER: "[PREDICT]"
        columns:
          type: object
          description: Table data organized by columns (mutually exclusive with rows).
          additionalProperties:
            type: array
            items: { }
          example:
            PRODUCT: [ "Couch", "Office Chair", "Server Rack" ]
            PRICE: [ 999.99, 150.8, 2200.00 ]
            ORDERDATE: [ "28-11-2025", "02-11-2025", "01-11-2025" ]
            ID: [ "35", "44", "104" ]
            COSTCENTER: [ "[PREDICT]", "Office Furniture", "Data Infrastructure" ]
        data_schema:
          $ref: '#/components/schemas/DataSchema'
        parse_data_types:
          type: boolean
          description: Whether to parse data types when data_schema is not provided eg. interpret date, numeric
          default: true
      oneOf:
        - required: [ prediction_config, rows ]
        - required: [ prediction_config, columns ]
    PredictionConfig:
      type: object
      description: Configuration specifying which columns to predict.
      properties:
        target_columns:
          type: array
          description: Array of target column configurations for prediction.
          minItems: 1
          items:
            $ref: '#/components/schemas/TargetColumn'
    TargetColumn:
      type: object
      description: Configuration for a target column to predict.
      required:
        - prediction_placeholder
      properties:
        name:
          type: string
          description: Name of the column to predict.
          example: "COSTCENTER"
        prediction_placeholder:
          type: string
          description: Value used as placeholder in cells where prediction is needed.
          example: "[PREDICT]"
        task_type:
          type: string
          enum: [ classification, regression ]
          description: (Optional) Type of prediction task. If omitted, model attempts to infer task type.
    DataSchema:
      type: object
      description: (Optional) Schema definition for column data types. If omitted and parse_data_types is true, data types will be inferred.
      additionalProperties:
        $ref: '#/components/schemas/ColumnDataType'
      example:
        PRODUCT:
          dtype: "string"
        PRICE:
          dtype: "numeric"
        ORDERDATE:
          dtype: "date"
    ColumnDataType:
      type: object
      description: Data type specification for a column.
      properties:
        dtype:
          type: string
          enum: [ string, numeric, date ]
          description: Data type for the column.
          example: "string"

    TabCompletionPostResponse:
      type: object
      description: Successful tabular prediction response.
      properties:
        id:
          type: string
          description: The generated UUID4 for this request (useful for logging).
          example: "c334f854-0d70-4c79-bd73-9ac581fd8cda"
        status:
          $ref: '#/components/schemas/ErrorStatus'
        predictions:
          type: array
          description: Array of prediction results sequence-aligned with the order of the query rows in the request.
          items:
            $ref: '#/components/schemas/PredictionResults'
        metadata:
          $ref: '#/components/schemas/TabCompletionMetadata'
    PredictionResults:
      type: object
      description: Prediction results for a query row that may contain target column predictions and optional index column.
      additionalProperties:
        oneOf:
          - type: string
            description: Index column value (when index_column parameter is specified).
          - type: array
            description: Array of predictions for a target column.
            items:
              $ref: '#/components/schemas/Prediction'
    Prediction:
      type: object
      description: Individual prediction result for a cell.
      properties:
        prediction:
          oneOf:
            - type: string
              description: Predicted value for classification tasks.
            - type: number
              format: float
              description: Predicted value for regression tasks.
        confidence:
          type: number
          format: float
          nullable: true
          description: The confidence score for this prediction (for classification tasks only).
    TabCompletionMetadata:
      type: object
      description: TabCompletionMetadata about the prediction request.
      properties:
        num_rows:
          type: integer
          description: The total number of input rows.
        num_columns:
          type: integer
          description: The total number of input columns.
        num_predictions:
          type: integer
          description: The number of table cells containing the specified placeholder values summed over all target columns.
        num_query_rows:
          type: integer
          description: The number of query rows for which a prediction was made.

    ErrorResponse:
      type: object
      description: Error response with status and validation details.
      properties:
        status:
          allOf:
            - $ref: '#/components/schemas/ErrorStatus'
            - properties:
                code:
                  enum: [ 2 ]
                  example: 2
                message:
                  example: "Invalid input"
        detail:
          type: array
          description: Array of validation errors in pydantic format.
          items:
            $ref: '#/components/schemas/ErrorDetail'
    InternalServerErrorResponse:
      type: object
      description: Internal server error response.
      properties:
        status:
          type: integer
          enum: [ 3 ]
          example: 3
        message:
          type: string
          example: "Internal server error"
    ErrorDetail:
      type: object
      description: Validation error detail in pydantic format.
      properties:
        loc:
          type: array
          description: Location of the error in the request structure.
          items:
            oneOf:
              - type: string
              - type: integer
        msg:
          type: string
          description: Error message.
        type:
          type: string
          description: Error type.
    ErrorStatus:
      type: object
      description: ErrorStatus object indicating the result of the request.
      properties:
        code:
          type: integer
          description: The numeric status code.
          enum: [ 0, 1, 2, 3 ]
        message:
          type: string
          description: The status message text.